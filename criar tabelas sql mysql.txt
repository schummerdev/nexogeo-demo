-- Tabela para armazenar os dados da emissora
CREATE TABLE emissoras (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(255) NOT NULL,
    logo_url TEXT,
    tema_cor VARCHAR(50) DEFAULT 'branco'
);

-- Tabela para os usuários administradores do painel
CREATE TABLE usuarios_admin (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    senha_hash VARCHAR(255) NOT NULL,
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabela para cadastrar as promoções
CREATE TABLE promocoes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(255) NOT NULL,
    descricao TEXT,
    data_inicio DATE NOT NULL,
    data_fim DATE NOT NULL,
    status VARCHAR(50) DEFAULT 'ativa',
    criado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabela principal para registrar os participantes
CREATE TABLE participantes (
    id INT AUTO_INCREMENT PRIMARY KEY,
    promocao_id INT NOT NULL,
    nome VARCHAR(255) NOT NULL,
    telefone VARCHAR(20) NOT NULL,
    bairro VARCHAR(255),
    cidade VARCHAR(255),
    -- Armazena a geolocalização como dois campos decimais
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8),
    origem_source VARCHAR(100),
    origem_medium VARCHAR(100),
    participou_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (promocao_id) REFERENCES promocoes(id) ON DELETE CASCADE,
    INDEX (telefone),
    UNIQUE KEY (promocao_id, telefone)
);

-- Tabela para registrar os ganhadores de cada sorteio
CREATE TABLE ganhadores (
    id INT AUTO_INCREMENT PRIMARY KEY,
    promocao_id INT NOT NULL,
    participante_id INT NOT NULL,
    sorteado_em TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (promocao_id) REFERENCES promocoes(id),
    FOREIGN KEY (participante_id) REFERENCES participantes(id)
);
